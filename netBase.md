---
title: 网络基础知识
include_toc: true
---

# 网络基础知识

## 互联网

互联网，就是全世界有很多服务器(专门提供服务的计算机)对外提供服务，我们的计算机(包括手机)可以访问这些服务。服务器之间还可以互相提供服务。这样形成的一个巨大的网络。

用浏览器看到的网页，有个特点，就是网页上有很多可以点击的链接，这就是www协议(World Wide Web)。www本质上是存在链接的文本，即超文本(hyperlink text)，超文本体现了我们后来使用的网站/网页的本质，每个网页的文本中都存在超链接(hyperlink)，使我们在看文章时，对有兴趣的内容可以点击超链接来看它的相关内容。www将网络上不同的服务器提供的服务连接在一起，形成一个全球性的大网络，就是互联网，同时将这海量服务器的信息也连接成一个巨大的网络体，使我们面前的信息不再是孤立的，而是一个巨大的信息体，我们可以在这个巨大的信息海洋中傲游。

访问网站的网页，所用的软件是浏览器，就是前面提到的Google Chrome或Firefox等，浏览器向服务器发出www协议的请求，服务器收到请求响应对应的数据，这些数据符合html格式，浏览器接收到这个数据，渲染成页面显示给我们。

怎么选择访问哪个服务器呢？每个服务器(以及每个客户端)都有一个编号，称为IP(Internet Protocol)地址，是4个字节表示，如(10进制表示为)：123.25.44.12，这样的IP地址是ipv4，可以算出来这最多表示$2^{32}$个，但实际可用的地址比这小得多，现在已经启用ipv6，位数多了很多，可以让地球上每粒砂子都拥有一个ip地址。

IP地址表示一台计算机，那么同一台服务器如果提供多个服务(或者同一台客户机访问多个服务)怎么办？IP协议中还定义了一个数称为端口(Port)，用2个字节表示，所以同一台服务器最多可以提供65535个服务，要访问一台计算机上的某个服务，客户机需要请求ip和端口。在IP协议中，一些常见的服务已经定义了标准端口，所以访问标准端口的服务服务无需提供端口，但实际请求程序会把标准端口补上，比如：http/80，https/443, ssh/22, ftp/21 等等。我们一般访问网站www就是http协议80端口，但在google等公司的推动下，http基本已经被加密的https协议替代，目前几乎所有网站都使用https协议。

用数字的ip地址访问网站难以记忆，就像手机里的通信录，让你记电话号码太难了，但用通信录的名字就容易很多，所以DNS(Domain Name Service)就用于将服务器名字解析为IP地址，www.google.com中，google.com称为域名(Domain Name)，归google公司所有，是域名管理机构发的; www是服务器名，是google自己定义的。在浏览器上输入 www.google.com，浏览器首先请求dns服务器得到IP地址，再将请求发给这个ip的443端口请求服务，得到响应的网页。

一个www服务器不止提供一个页面，直接访问https://www.google.com 得到的是首页，首页上的链接或搜索引导我们到另一个页面，这个页面就不止是服务器名了，在后面还有内容，这整个地址称为URL（Uniform Resoure Locator）。使用非标准端口时要把端口号加上。 

以是否有服务器提供服务区分，应用程序可以分为两类，一类是本地程序，无需服务器支持，另一类是C/S程序(Client/Server)，需要服务器支持，目前很多程序都需要服务器支持，例如微信、网游。不过即使是本地程序，一般也会带有网络支持的功能，比如自动升级、使用情况统计等，完全不联网的软件很少了。但随着www服务的发展，网站提供的不仅仅是网页了，C/S程序的功能靠浏览器里的动态网页就能完成，因此形成了一大类应用称为B/S程序(Browser/Server)。github.io就是一个B/S程序，B/S程序的好处是无需安装客户端程序，自然也无需升级客户端程序，服务器端一升级，系统就完成升级了。

## 局域网

与互联网相对的，就是本地的局域网，比如家用wifi路由器下连接的所有计算机和手机，就形成一个局域网，可以用其中一台计算机作为服务器，把家里的通用服务放在服务器上，比如照片存档和共享、电影下载和共享等等。局域网中使用的ip地址是早已定义给内部网使用的网段(10.x.x.x/24、172.16.x.x/16、192.168.x.x/8)，通过路由器NAT(Netword Address Translation)，在路由器的外口，访问源地址被转换成运营商分配的外网地址，这个地址是运营商范围内的用户共享的(数量一般少于用户数)、动态分配的、时常在变的，因此不可能被标准的dns所解析，因此后来出现的DDNS(Dynamic DNS)服务，服务于这个场合。服务器只需要定时给 DDNS 发送更新请求，它就总能得到本站的外网ip，以便你能通过DDNS的解析访问到它。但国内运营商一般封了80/443等常用服务，所以只能用非标端口，无法作为正式网站发布。

计算机网卡有唯一的网卡地址，叫MAC地址，每个局域网子网（被路由器或三层交换机分隔的）中，计算机的MAC地址必须唯一，否则就发生冲突导致无法连接。

## 网络分层模型

|层级|OSI七层模型|TCP/IP五层模型|常用协议|
|--|--|--|--|
| 7 | 应用层 |  |  |
| 6 | 表示层 |  |  |
| 5 | 会话层 | 应用层 | **HTTP/HTTPS**、Telnet、FTP、TFTP、DNS、SMTP |
| 4 | 传输层 | 传输层 | **TCP**、UDP |
| 3 | 网络层 | 网络层 | **IP**、ICMP、RIP、IGMP、OSPF |
| 2 | 数据链路层 | 数据链路层 | Ethernet、PPP、PPTP/L2TP、ARP、ATMP |
| 1 | 物理层 | 物理层 | 物理线路、光线、双绞线、无线 |

上面提到的网卡的MAC地址属于二层以太网Ethernet，使用二层交换机连接的若干台电脑及其他设备是使用MAC地址互相识别、并通过双绞线连接在一起，互相通信。TCP/IP五层模型的下两层数据链路层和物理层实际实现时是一层：网络接口层，但网络交换机还是习惯称为二层设备(而不是一层设备)。

上面提到的IP地址是网络层的概念，IP地址被掩码分为子网，子网内部靠二层交换机就可以连接通信，而子网之间则需要路由器、三层交换机这样的三层设备实现数据包转发通信。

例如两个子网192.168.1.0/24和192.168.2.0/24两个子网(4个数各为1个字节，0~255，24位掩码就是前3个字节固定，最后1个字节任意的一个子网，最多256个设备，当然，0作为子网地址，255作为广播地址，最多实际254个设备)。显然这两个子网的地址相互独立，要互相通信，在两个子网间就需要路由器，路由器1个网口是192.168.1.1另一个网口是192.168.2.1。192.168.1.0/24子网内的设备要设置192.168.2.0/24 gw 192.168.1.1路由，意思是所有访问192.168.2.0/24的数据包送到网关(GateWay)192.168.1.1，反之也类似，这样这两个子网就能互通了。整个互联网就是这样一个个子网和大量的路由器连接起来的，这样你就能访问到互联网上任何一台机器。

这样的IP地址称为IPv4，数量可以算出来，就是$2^{32}$大约40亿个，再去掉内网保留(10.x.x.x/24、172.16.x.x/16、192.168.x.x/8)、路由器占用等等，实际数量并非很充足，因此IPv6开始慢慢使用，而IPv4则使用NAT技术将无需对外服务、无需同时服务的用户共享少量IP地址，例如一个小区，运营商可能只给他10个IP，其实小区有数千用户，所有小区用使用内部保留IP，内部用户访问互联网时，路由器将源地址NAT(Network Address Translate)为运营商的外部IP，服务器收到请求后将响应回给这个外部IP，路由器再根据记录的请求是谁，将响应返回给正确的内部IP(即内部请求方)。所以理论上这个小区有1个外部IP就行了，极少量的用户可能需要外部IP，可以通过路由器上的IP映射功能将某个外部IP映射给这个用户，这样互联网上别人也可以访问这个用户的电脑了。

